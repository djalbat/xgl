"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return Scene;
    }
});
const _part = /*#__PURE__*/ _interop_require_default(require("../element/part"));
const _camera = /*#__PURE__*/ _interop_require_default(require("../element/camera"));
const _element = /*#__PURE__*/ _interop_require_default(require("../element"));
const _userInput = /*#__PURE__*/ _interop_require_default(require("../miscellaneous/userInput"));
const _vector = require("../maths/vector");
const _defaults = require("../defaults");
const _element1 = require("../utilities/element");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
class Scene extends _element.default {
    constructor(parts, camera, canvas, colour){
        super();
        this.parts = parts;
        this.camera = camera;
        this.canvas = canvas;
        this.colour = colour;
    }
    getParts() {
        return this.parts;
    }
    getCamera() {
        return this.camera;
    }
    getCanvas() {
        return this.canvas;
    }
    getColour() {
        return this.colour;
    }
    escapeKeyDownHandler = ()=>{
        this.camera.reset();
        this.windowResizeHandler(); ///
    };
    windowResizeHandler = ()=>{
        const clientWidth = this.canvas.getClientWidth(), clientHeight = this.canvas.getClientHeight(), width = clientWidth, height = clientHeight;
        this.canvas.resize(width, height);
        const relativeMouseCoordinates = (0, _vector.zero2)(), mouseWheelDelta = 0, shiftKeyDown = false; ///
        this.userInputHandler(relativeMouseCoordinates, mouseWheelDelta, shiftKeyDown);
    };
    userInputHandler = (relativeMouseCoordinates, mouseWheelDelta, shiftKeyDown)=>{
        const render = this.render.bind(this);
        this.camera.update(relativeMouseCoordinates, mouseWheelDelta, shiftKeyDown, this.canvas, render);
    };
    initialise(canvas, marginOfError) {
        const userInput = _userInput.default.fromNothing();
        this.parts.forEach((part)=>{
            part.initialise(canvas, marginOfError);
        });
        userInput.initialise(canvas);
        userInput.addUserInputHandler(this.userInputHandler);
        userInput.addEscapeKeyDownHandler(this.escapeKeyDownHandler);
        window.onresize = this.windowResizeHandler;
        this.windowResizeHandler(); ///
    }
    render(offsetsMatrix, normalsMatrix, positionMatrix, rotationsMatrix, projectionMatrix) {
        this.canvas.clear(this.colour);
        this.parts.forEach((part)=>{
            part.render(offsetsMatrix, normalsMatrix, positionMatrix, rotationsMatrix, projectionMatrix, this.canvas);
        });
    }
    static fromProperties(properties) {
        const { canvas, childElements, backgroundColour = _defaults.DEFAULT_BACKGROUND_COLOUR } = properties, parts = (0, _element1.elementsFromChildElements)(childElements, _part.default), camera = (0, _element1.elementFromChildElements)(childElements, _camera.default), colour = backgroundColour, scene = _element.default.fromProperties(Scene, properties, parts, camera, canvas, colour), marginOfError = _defaults.DEFAULT_MARGIN_OF_ERROR;
        scene.initialise(canvas, marginOfError);
        return scene;
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lbGVtZW50L3NjZW5lLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgUGFydCBmcm9tIFwiLi4vZWxlbWVudC9wYXJ0XCI7XG5pbXBvcnQgQ2FtZXJhIGZyb20gXCIuLi9lbGVtZW50L2NhbWVyYVwiO1xuaW1wb3J0IEVsZW1lbnQgZnJvbSBcIi4uL2VsZW1lbnRcIjtcbmltcG9ydCBVc2VySW5wdXQgZnJvbSBcIi4uL21pc2NlbGxhbmVvdXMvdXNlcklucHV0XCI7XG5cbmltcG9ydCB7IHplcm8yIH0gZnJvbSBcIi4uL21hdGhzL3ZlY3RvclwiO1xuaW1wb3J0IHsgREVGQVVMVF9NQVJHSU5fT0ZfRVJST1IsIERFRkFVTFRfQkFDS0dST1VORF9DT0xPVVIgfSBmcm9tIFwiLi4vZGVmYXVsdHNcIjtcbmltcG9ydCB7IGVsZW1lbnRGcm9tQ2hpbGRFbGVtZW50cywgZWxlbWVudHNGcm9tQ2hpbGRFbGVtZW50cyB9IGZyb20gXCIuLi91dGlsaXRpZXMvZWxlbWVudFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY2VuZSBleHRlbmRzIEVsZW1lbnQge1xuICBjb25zdHJ1Y3RvcihwYXJ0cywgY2FtZXJhLCBjYW52YXMsIGNvbG91cikge1xuICAgIHN1cGVyKCk7XG5cbiAgICB0aGlzLnBhcnRzID0gcGFydHM7XG4gICAgdGhpcy5jYW1lcmEgPSBjYW1lcmE7XG4gICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XG4gICAgdGhpcy5jb2xvdXIgPSBjb2xvdXI7XG4gIH1cblxuICBnZXRQYXJ0cygpIHtcbiAgICByZXR1cm4gdGhpcy5wYXJ0cztcbiAgfVxuXG4gIGdldENhbWVyYSgpIHtcbiAgICByZXR1cm4gdGhpcy5jYW1lcmE7XG4gIH1cblxuICBnZXRDYW52YXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2FudmFzO1xuICB9XG5cbiAgZ2V0Q29sb3VyKCkge1xuICAgIHJldHVybiB0aGlzLmNvbG91cjtcbiAgfVxuXG4gIGVzY2FwZUtleURvd25IYW5kbGVyID0gKCkgPT4ge1xuICAgIHRoaXMuY2FtZXJhLnJlc2V0KCk7XG5cbiAgICB0aGlzLndpbmRvd1Jlc2l6ZUhhbmRsZXIoKTsgLy8vXG4gIH1cblxuICB3aW5kb3dSZXNpemVIYW5kbGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGNsaWVudFdpZHRoID0gdGhpcy5jYW52YXMuZ2V0Q2xpZW50V2lkdGgoKSxcbiAgICAgICAgICBjbGllbnRIZWlnaHQgPSB0aGlzLmNhbnZhcy5nZXRDbGllbnRIZWlnaHQoKSxcbiAgICAgICAgICB3aWR0aCA9IGNsaWVudFdpZHRoLCAgLy8vXG4gICAgICAgICAgaGVpZ2h0ID0gY2xpZW50SGVpZ2h0O1xuXG4gICAgdGhpcy5jYW52YXMucmVzaXplKHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgY29uc3QgcmVsYXRpdmVNb3VzZUNvb3JkaW5hdGVzID0gemVybzIoKSwgLy8vXG4gICAgICAgICAgbW91c2VXaGVlbERlbHRhID0gMCwgIC8vL1xuICAgICAgICAgIHNoaWZ0S2V5RG93biA9IGZhbHNlOyAvLy9cblxuICAgIHRoaXMudXNlcklucHV0SGFuZGxlcihyZWxhdGl2ZU1vdXNlQ29vcmRpbmF0ZXMsIG1vdXNlV2hlZWxEZWx0YSwgc2hpZnRLZXlEb3duKTtcbiAgfVxuXG4gIHVzZXJJbnB1dEhhbmRsZXIgPSAocmVsYXRpdmVNb3VzZUNvb3JkaW5hdGVzLCBtb3VzZVdoZWVsRGVsdGEsIHNoaWZ0S2V5RG93bikgPT4ge1xuICAgIGNvbnN0IHJlbmRlciA9IHRoaXMucmVuZGVyLmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLmNhbWVyYS51cGRhdGUocmVsYXRpdmVNb3VzZUNvb3JkaW5hdGVzLCBtb3VzZVdoZWVsRGVsdGEsIHNoaWZ0S2V5RG93biwgdGhpcy5jYW52YXMsIHJlbmRlcik7XG4gIH1cblxuICBpbml0aWFsaXNlKGNhbnZhcywgbWFyZ2luT2ZFcnJvcikge1xuICAgIGNvbnN0IHVzZXJJbnB1dCA9IFVzZXJJbnB1dC5mcm9tTm90aGluZygpO1xuXG4gICAgdGhpcy5wYXJ0cy5mb3JFYWNoKChwYXJ0KSA9PiB7XG4gICAgICBwYXJ0LmluaXRpYWxpc2UoY2FudmFzLCBtYXJnaW5PZkVycm9yKTtcbiAgICB9KTtcblxuICAgIHVzZXJJbnB1dC5pbml0aWFsaXNlKGNhbnZhcyk7XG5cbiAgICB1c2VySW5wdXQuYWRkVXNlcklucHV0SGFuZGxlcih0aGlzLnVzZXJJbnB1dEhhbmRsZXIpO1xuXG4gICAgdXNlcklucHV0LmFkZEVzY2FwZUtleURvd25IYW5kbGVyKHRoaXMuZXNjYXBlS2V5RG93bkhhbmRsZXIpO1xuXG4gICAgd2luZG93Lm9ucmVzaXplID0gdGhpcy53aW5kb3dSZXNpemVIYW5kbGVyO1xuXG4gICAgdGhpcy53aW5kb3dSZXNpemVIYW5kbGVyKCk7IC8vL1xuICB9XG5cbiAgcmVuZGVyKG9mZnNldHNNYXRyaXgsIG5vcm1hbHNNYXRyaXgsIHBvc2l0aW9uTWF0cml4LCByb3RhdGlvbnNNYXRyaXgsIHByb2plY3Rpb25NYXRyaXgpIHtcbiAgICB0aGlzLmNhbnZhcy5jbGVhcih0aGlzLmNvbG91cik7XG5cbiAgICB0aGlzLnBhcnRzLmZvckVhY2goKHBhcnQpID0+IHtcbiAgICAgIHBhcnQucmVuZGVyKG9mZnNldHNNYXRyaXgsIG5vcm1hbHNNYXRyaXgsIHBvc2l0aW9uTWF0cml4LCByb3RhdGlvbnNNYXRyaXgsIHByb2plY3Rpb25NYXRyaXgsIHRoaXMuY2FudmFzKTtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBmcm9tUHJvcGVydGllcyhwcm9wZXJ0aWVzKSB7XG4gICAgY29uc3QgeyBjYW52YXMsIGNoaWxkRWxlbWVudHMsIGJhY2tncm91bmRDb2xvdXIgPSBERUZBVUxUX0JBQ0tHUk9VTkRfQ09MT1VSIH0gPSBwcm9wZXJ0aWVzLFxuICAgICAgICAgIHBhcnRzID0gZWxlbWVudHNGcm9tQ2hpbGRFbGVtZW50cyhjaGlsZEVsZW1lbnRzLCBQYXJ0KSxcbiAgICAgICAgICBjYW1lcmEgPSBlbGVtZW50RnJvbUNoaWxkRWxlbWVudHMoY2hpbGRFbGVtZW50cywgQ2FtZXJhKSxcbiAgICAgICAgICBjb2xvdXIgPSBiYWNrZ3JvdW5kQ29sb3VyLCAgLy9cbiAgICAgICAgICBzY2VuZSA9IEVsZW1lbnQuZnJvbVByb3BlcnRpZXMoU2NlbmUsIHByb3BlcnRpZXMsIHBhcnRzLCBjYW1lcmEsIGNhbnZhcywgY29sb3VyKSxcbiAgICAgICAgICBtYXJnaW5PZkVycm9yID0gREVGQVVMVF9NQVJHSU5fT0ZfRVJST1I7XG5cbiAgICBzY2VuZS5pbml0aWFsaXNlKGNhbnZhcywgbWFyZ2luT2ZFcnJvcik7XG5cbiAgICByZXR1cm4gc2NlbmU7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJTY2VuZSIsIkVsZW1lbnQiLCJwYXJ0cyIsImNhbWVyYSIsImNhbnZhcyIsImNvbG91ciIsImdldFBhcnRzIiwiZ2V0Q2FtZXJhIiwiZ2V0Q2FudmFzIiwiZ2V0Q29sb3VyIiwiZXNjYXBlS2V5RG93bkhhbmRsZXIiLCJyZXNldCIsIndpbmRvd1Jlc2l6ZUhhbmRsZXIiLCJjbGllbnRXaWR0aCIsImdldENsaWVudFdpZHRoIiwiY2xpZW50SGVpZ2h0IiwiZ2V0Q2xpZW50SGVpZ2h0Iiwid2lkdGgiLCJoZWlnaHQiLCJyZXNpemUiLCJyZWxhdGl2ZU1vdXNlQ29vcmRpbmF0ZXMiLCJ6ZXJvMiIsIm1vdXNlV2hlZWxEZWx0YSIsInNoaWZ0S2V5RG93biIsInVzZXJJbnB1dEhhbmRsZXIiLCJyZW5kZXIiLCJiaW5kIiwidXBkYXRlIiwiaW5pdGlhbGlzZSIsIm1hcmdpbk9mRXJyb3IiLCJ1c2VySW5wdXQiLCJVc2VySW5wdXQiLCJmcm9tTm90aGluZyIsImZvckVhY2giLCJwYXJ0IiwiYWRkVXNlcklucHV0SGFuZGxlciIsImFkZEVzY2FwZUtleURvd25IYW5kbGVyIiwid2luZG93Iiwib25yZXNpemUiLCJvZmZzZXRzTWF0cml4Iiwibm9ybWFsc01hdHJpeCIsInBvc2l0aW9uTWF0cml4Iiwicm90YXRpb25zTWF0cml4IiwicHJvamVjdGlvbk1hdHJpeCIsImNsZWFyIiwiZnJvbVByb3BlcnRpZXMiLCJwcm9wZXJ0aWVzIiwiY2hpbGRFbGVtZW50cyIsImJhY2tncm91bmRDb2xvdXIiLCJERUZBVUxUX0JBQ0tHUk9VTkRfQ09MT1VSIiwiZWxlbWVudHNGcm9tQ2hpbGRFbGVtZW50cyIsIlBhcnQiLCJlbGVtZW50RnJvbUNoaWxkRWxlbWVudHMiLCJDYW1lcmEiLCJzY2VuZSIsIkRFRkFVTFRfTUFSR0lOX09GX0VSUk9SIl0sIm1hcHBpbmdzIjoiQUFBQTs7OzsrQkFXQTs7O2VBQXFCQTs7OzZEQVRKOytEQUNFO2dFQUNDO2tFQUNFO3dCQUVBOzBCQUM2QzswQkFDQzs7Ozs7O0FBRXJELE1BQU1BLGNBQWNDLGdCQUFPO0lBQ3hDLFlBQVlDLEtBQUssRUFBRUMsTUFBTSxFQUFFQyxNQUFNLEVBQUVDLE1BQU0sQ0FBRTtRQUN6QyxLQUFLO1FBRUwsSUFBSSxDQUFDSCxLQUFLLEdBQUdBO1FBQ2IsSUFBSSxDQUFDQyxNQUFNLEdBQUdBO1FBQ2QsSUFBSSxDQUFDQyxNQUFNLEdBQUdBO1FBQ2QsSUFBSSxDQUFDQyxNQUFNLEdBQUdBO0lBQ2hCO0lBRUFDLFdBQVc7UUFDVCxPQUFPLElBQUksQ0FBQ0osS0FBSztJQUNuQjtJQUVBSyxZQUFZO1FBQ1YsT0FBTyxJQUFJLENBQUNKLE1BQU07SUFDcEI7SUFFQUssWUFBWTtRQUNWLE9BQU8sSUFBSSxDQUFDSixNQUFNO0lBQ3BCO0lBRUFLLFlBQVk7UUFDVixPQUFPLElBQUksQ0FBQ0osTUFBTTtJQUNwQjtJQUVBSyx1QkFBdUI7UUFDckIsSUFBSSxDQUFDUCxNQUFNLENBQUNRLEtBQUs7UUFFakIsSUFBSSxDQUFDQyxtQkFBbUIsSUFBSSxHQUFHO0lBQ2pDLEVBQUM7SUFFREEsc0JBQXNCO1FBQ3BCLE1BQU1DLGNBQWMsSUFBSSxDQUFDVCxNQUFNLENBQUNVLGNBQWMsSUFDeENDLGVBQWUsSUFBSSxDQUFDWCxNQUFNLENBQUNZLGVBQWUsSUFDMUNDLFFBQVFKLGFBQ1JLLFNBQVNIO1FBRWYsSUFBSSxDQUFDWCxNQUFNLENBQUNlLE1BQU0sQ0FBQ0YsT0FBT0M7UUFFMUIsTUFBTUUsMkJBQTJCQyxJQUFBQSxhQUFLLEtBQ2hDQyxrQkFBa0IsR0FDbEJDLGVBQWUsT0FBTyxHQUFHO1FBRS9CLElBQUksQ0FBQ0MsZ0JBQWdCLENBQUNKLDBCQUEwQkUsaUJBQWlCQztJQUNuRSxFQUFDO0lBRURDLG1CQUFtQixDQUFDSiwwQkFBMEJFLGlCQUFpQkM7UUFDN0QsTUFBTUUsU0FBUyxJQUFJLENBQUNBLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDLElBQUk7UUFFcEMsSUFBSSxDQUFDdkIsTUFBTSxDQUFDd0IsTUFBTSxDQUFDUCwwQkFBMEJFLGlCQUFpQkMsY0FBYyxJQUFJLENBQUNuQixNQUFNLEVBQUVxQjtJQUMzRixFQUFDO0lBRURHLFdBQVd4QixNQUFNLEVBQUV5QixhQUFhLEVBQUU7UUFDaEMsTUFBTUMsWUFBWUMsa0JBQVMsQ0FBQ0MsV0FBVztRQUV2QyxJQUFJLENBQUM5QixLQUFLLENBQUMrQixPQUFPLENBQUMsQ0FBQ0M7WUFDbEJBLEtBQUtOLFVBQVUsQ0FBQ3hCLFFBQVF5QjtRQUMxQjtRQUVBQyxVQUFVRixVQUFVLENBQUN4QjtRQUVyQjBCLFVBQVVLLG1CQUFtQixDQUFDLElBQUksQ0FBQ1gsZ0JBQWdCO1FBRW5ETSxVQUFVTSx1QkFBdUIsQ0FBQyxJQUFJLENBQUMxQixvQkFBb0I7UUFFM0QyQixPQUFPQyxRQUFRLEdBQUcsSUFBSSxDQUFDMUIsbUJBQW1CO1FBRTFDLElBQUksQ0FBQ0EsbUJBQW1CLElBQUksR0FBRztJQUNqQztJQUVBYSxPQUFPYyxhQUFhLEVBQUVDLGFBQWEsRUFBRUMsY0FBYyxFQUFFQyxlQUFlLEVBQUVDLGdCQUFnQixFQUFFO1FBQ3RGLElBQUksQ0FBQ3ZDLE1BQU0sQ0FBQ3dDLEtBQUssQ0FBQyxJQUFJLENBQUN2QyxNQUFNO1FBRTdCLElBQUksQ0FBQ0gsS0FBSyxDQUFDK0IsT0FBTyxDQUFDLENBQUNDO1lBQ2xCQSxLQUFLVCxNQUFNLENBQUNjLGVBQWVDLGVBQWVDLGdCQUFnQkMsaUJBQWlCQyxrQkFBa0IsSUFBSSxDQUFDdkMsTUFBTTtRQUMxRztJQUNGO0lBRUEsT0FBT3lDLGVBQWVDLFVBQVUsRUFBRTtRQUNoQyxNQUFNLEVBQUUxQyxNQUFNLEVBQUUyQyxhQUFhLEVBQUVDLG1CQUFtQkMsbUNBQXlCLEVBQUUsR0FBR0gsWUFDMUU1QyxRQUFRZ0QsSUFBQUEsbUNBQXlCLEVBQUNILGVBQWVJLGFBQUksR0FDckRoRCxTQUFTaUQsSUFBQUEsa0NBQXdCLEVBQUNMLGVBQWVNLGVBQU0sR0FDdkRoRCxTQUFTMkMsa0JBQ1RNLFFBQVFyRCxnQkFBTyxDQUFDNEMsY0FBYyxDQUFDN0MsT0FBTzhDLFlBQVk1QyxPQUFPQyxRQUFRQyxRQUFRQyxTQUN6RXdCLGdCQUFnQjBCLGlDQUF1QjtRQUU3Q0QsTUFBTTFCLFVBQVUsQ0FBQ3hCLFFBQVF5QjtRQUV6QixPQUFPeUI7SUFDVDtBQUNGIn0=